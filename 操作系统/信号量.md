## 什么是信号量机制

1965年，荷兰学者Edsger Dijkstra提出了一种经典的实现进程互斥、同步的方法--信号量机制。

信号量机制用于解决并发访问共享资源的同步问题。信号量机制的主要目的是确保多个进程在共享资源时不会发生冲突，并且能够正确地同步和通信。信号量机制如今在操作系统中被广泛应用，如进程间的同步和通信、资源分配、优先级调度等。

## 信号量机制诞生之前

在信号量机制出现之前，解决进程互斥问题的方法主要有以下几种：

1. 软件方法：单标志法，双标志先检查，双标志后检查，Peterson算法
2. 硬件方法：中断屏蔽法，TS/TSL指令、Swap/XCHG指令

这些方法都存在无法实现“让权等待”或者导致死锁等问题，让权等待指的是进程如果需要等待其他资源，应该立即释放CPU，让其他进程获得运行机会。   

因此，信号量机制的提出提供了一种更加有效和可靠的方法来解决进程互斥问题。

## 信号量机制的基本概念

### 信号量的定义和类型

信号量其实就是一个变量（可以是一个整数，也可以是更复杂的记录型变量)，可以用一个信号量来表示系统中某种资源的数量，比如：系统中只有一台打印机,就可以设置一个初值为1的信号量。

信号量有三种类型：

1. 二元信号量：这种信号量只有两种状态，通常用于实现互斥锁或二进制信号量。其取值范围为0和1，1表示资源未被分配，0表示资源已被分配。二元信号量主要用于实现资源的互斥访问。
2. 记录型信号量：这种信号量有一个整数值，用于表示可用的资源数。其取值范围为非负整数，其中整数值越大表示可用的资源越多。记录型信号量主要用于实现资源的共享访问。
3. 信号量集：这种信号量由多个信号量组成，每个信号量都有自己的整数值。信号量集主要用于实现复杂的同步操作，例如多任务单向同步、多任务双向同步等。

无论哪种类型的信号量，其主要作用都是用于控制进程或线程对共享资源的访问，以避免并发访问导致的数据不一致性和其他并发问题。

### 信号量的操作

信号量只能通过操作系统提供的一对**原语**操作，一般将这两种操作简称为P、V。

> 在《深入理解计算机系统》一书中，旁注了P和V名字的起源。P和V来源于荷兰语单词 Proberen（测试）和 Verhogen（增加），信号量的提出者正是荷兰学者。

原语是一种特殊的程序段，其执行**只能一气呵成，不可被中断**。原语是由关中断/开中断指令实现的。

PV操作：

- P(s): 如果s是非零的，那么P将s减1，并且立即返回。如果s为0，那么就挂起这个线程，直到S变为非0，而一个V操作会唤醒这个线程。在唤醒之后，P操作将S减1，并将控制返回给调用者。
- V(s): V操作将S加1。如果有任何线程阻塞在P操作等待S变成非0，那么V操作会唤醒这些线程中的一个，然后该线程将S减1，完成它的P操作。



## 信号量机制实现进程互斥

> 一个信号量对应一种资源
>
> 信号量 = 这种资源的剩余数量 （信号量的值如果小于0，说明此时有进程在等待这种资源）
>
> P(s) : 申请一个资源s，如果资源不够就阻塞等待
>
> V(s)：释放一个资源s，如果有进程在等待该资源，则唤醒一个进程



~~~c++
semaphore mutex = 1; // 初始化信号量
// 进程1
process1(){
    ...
    P(mutes);     // 使用临界资源前加锁
    临界区代码段...
    V(mutex);     // 使用临界资源后解锁
    ...
}
// 进程2
process2(){
    ...
    P(mutes);     // 使用临界资源前加锁
    临界区代码段...
    V(mutex);     // 使用临界资源后解锁
    ...
}
~~~

假如两个进程要使用一台打印机，在使用之前，通过P操作申请打印机资源，使用完成以后通过V操作释放资源，让另一个进程可以访问打印机。

## 信号量机制实现进程同步













二、信号量机制的基本概念

1. 信号量的定义和类型
   a. 二值信号量
   b. 计数信号量
   c. 优先级信号量
2. 信号量的操作
   a. 初始化
   b. 等待（P操作）
   c. 发送（V操作）

《深入理解计算机操作系统》703页中旁注了P和V名字的起源

三、信号量机制的实现

1. 硬件支持
2. 操作系统级别的实现
   a. 进程间的同步
   b. 进程间的通信
3. 应用级别的实现
   a. 资源计数器
   b. 互斥锁
   c. 条件变量

四、信号量机制的常见问题及解决方案

1. 死锁
2. 饥饿
3. 优先级倒置
4. 其他问题及解决方案

五、信号量机制的应用案例

1. 生产者-消费者问题
2. Dijkstra的银行家算法
3. 其他应用案例

六、总结和展望

1. 信号量机制的优点和局限性
2. 未来发展和改进方向
3. 对实际应用的影响和启示